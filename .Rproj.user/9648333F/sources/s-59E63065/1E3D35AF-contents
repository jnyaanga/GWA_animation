---
title: "20200901_Manuscript Results"
output: 
  html_document:
    toc: true
    toc_float: true
    theme: paper
    toc_depth: 4
---

```{r, echo =  FALSE, message = FALSE}
library(tidyverse)
library(here)
library(ggsci)
library(cowplot)
library(easyXpress)
library(png)
library(ggpubr)

#raw data
plate <- readr::read_csv(here::here("processed", "20191119_GA1", "plate.csv"))
#raw data cleaned
clean_plate <- readr::read_csv(here::here("processed", "20191119_GA1", "raw_cleaned.csv"))
#student measurements
manual_measure <- readr::read_csv("/Users/joy/Box/Joy_worm_images/Joy/R\ scripts/all_student_measurements.csv")
```


## **Quantitative measurements of *C. elegans* growth**
### 1. Experimental set up and workflow  
+ Discussion of the two measurement platforms
+ General information about data aquisition (high replication, frequency of sampling, etc)  

#### ***Figure 1: Experimental Workflow and Representative Well Images (and distributions?)***
  ![**Experimental Platform**](images/Platform.jpeg)  
  ![**Representative Wells**](images/wells.jpeg)  
  
### 2. Measurements of animal length using the COPAS Biosort

#### ***Figure 2: Assessment of animal length using COPAS Biosort***
```{r, echo = FALSE, fig.width = 12, fig.height = 5}

plate %>%
  dplyr::filter(!replicate %in% c("no worms", "no food")) %>%
  ggplot(.) +
  aes(x = as.numeric(timepoint), y = TOF) + 
  geom_jitter(size=0.1, width=0.2, alpha=0.1) +
  scale_x_continuous(breaks = seq(0, 70, 5)) +
  theme_cowplot(font_size = 16, rel_small = 12/16) +
  labs(title = "Raw data of all replicates",
    x="Time (h)", y = expression(paste("Length (", mu,"m)")))

```


```{r, echo = FALSE, fig.width = 12, fig.height = 5}

clean_plate %>%
  ggplot(.) +
  aes(x = as.numeric(timepoint), y = TOF) + 
  geom_jitter(size=0.1, width=0.2, alpha=0.1) +
  scale_x_continuous(breaks = seq(0, 70, 5)) +
  theme_cowplot(font_size = 16, rel_small = 12/16) +
  labs(title = "Cleaned data for all replicates",
       x="Time (h)", y = expression(paste("Length (", mu,"m)")))

```
  *supplement will show how cleaning was done.*

```{r, echo = FALSE, fig.width = 12, fig.height = 5}

clean_plate %>%
  dplyr::group_by(replicate, timepoint, row, col) %>%
  dplyr::summarize(median.TOF = median(TOF), .groups = "drop") %>%
  ggplot(.) +
  aes(x = as.numeric(timepoint), y = median.TOF) + 
  geom_boxplot(aes(group = timepoint), outlier.alpha = 0) +
  geom_jitter(size=0.2, width=0.2, alpha=0.4) +
  scale_x_continuous(breaks = seq(0, 70, 5)) +
  theme_cowplot(font_size = 16, rel_small = 12/16) +
  labs(title = "Cleaned data summarized for all replicates",
       x="Time (h)", y = expression(paste("Median Length (", mu,"m)")))

```


### 3. Image acquired data brings additional insights
+ Correlate small objects seen in sorter data to cuticles found in images
+ Able to recapitulate sorter data
  + CellProfiler generated data informs us about changes in animal length
    ++ Dynamics in um are similar to those in TOF
    
#### ***Figure 3: Add CP Data here***
 
+ Able to further expand sorter data
  + Student measurements allow us to draw additional connections between sorter measruements and animal size parameters
    1. TOF -> Length
    2. norm.EXT -> Width
    3. EXT -> Area
  + Using these we can estimate volume from the sorter data

#### ***Figure 4: Correlation between manual measurements and COPAS Biosort aquired data***
```{r, echo = FALSE, message = FALSE, fig.width = 8, fig.height = 10}
# Correlation between student measurements and sorter data
sorter <- clean_plate %>%
  dplyr::mutate(volume = pi*(norm.EXT/2)^2*TOF, hour = timepoint, row = row, column = col) %>%
  dplyr::group_by(hour, row, column) %>%
  dplyr::summarize(s_length = median(TOF), s_width = median(norm.EXT), 
                   s_area = median(EXT), s_volume = median(volume), .groups = "drop")

student <- manual_measure %>%
  tidyr::separate(Well, into=c("row","column"), sep=c("(?<=[A-Za-z])(?=[0-9])")) %>%
  dplyr::mutate(hour = Hour, column = as.numeric(column)) %>%
  dplyr::group_by(hour, row, column) %>%
  dplyr::summarize(m_length = median(Length), m_width = median(Width), 
                   m_volume = median(Volume), m_area = median(Area), .groups = "drop")

all <- dplyr::inner_join(sorter, student) 

length <- ggscatter(all, x = "s_length", y = "m_length",
          add = "reg.line", conf.int = TRUE, size = 0.5, alpha=0.5, 
          cor.coef = TRUE, cor.method = "kendall", cor.coef.size = 4,
          subtitle = "Length & TOF", ylab = "Manual measurements", xlab = "COPAS Biosort measurements") +
  theme_cowplot(font_size = 12, rel_small = 10/12)

width <- ggscatter(all, x = "s_width", y = "m_width",
          add = "reg.line", conf.int = TRUE, size = 0.5, alpha=0.5, 
          cor.coef = TRUE, cor.method = "kendall", cor.coef.size = 4,
          subtitle = "Width & norm.EXT", ylab = "Manual measurements", xlab = "COPAS Biosort measurements") +
  theme_cowplot(font_size = 12, rel_small = 10/12)

area <- ggscatter(all, x = "s_area", y = "m_area",
          add = "reg.line", conf.int = TRUE, size = 0.5, alpha=0.5, 
          cor.coef = TRUE, cor.method = "kendall", cor.coef.size = 4,
          subtitle = "Area & EXT (log scaled axes)", ylab = "Manual measurements", xlab = "COPAS Biosort measurements") +
  theme_cowplot(font_size = 12, rel_small = 10/12) + scale_x_log10() + scale_y_log10()

volume <- ggscatter(all, x = "s_volume", y = "m_volume",
          add = "reg.line", conf.int = TRUE, size = 0.5, alpha=0.5, 
          cor.coef = TRUE, cor.method = "kendall", cor.coef.size = 4,
          subtitle = "Correlation in Volume (log scaled axes)", ylab = "Manual measurements", xlab = "COPAS Biosort measurements") +
  theme_cowplot(font_size = 12, rel_small = 10/12) + scale_x_log10() + scale_y_log10()

area_normEXT <- ggscatter(all, x = "s_width", y = "m_area",
          add = "reg.line", conf.int = TRUE, size = 0.5, alpha=0.5, 
          cor.coef = TRUE, cor.method = "kendall", cor.coef.size = 4,
          subtitle = "Area & norm.EXT (log scaled axes)", ylab = "Manual measurements", xlab = "COPAS Biosort measurements") +
  theme_cowplot(font_size = 12, rel_small = 10/12) + scale_x_log10() + scale_y_log10()


plot_grid(length, width, area, area_normEXT, volume, ncol = 2, nrow = 3, align = "hv")

```

   
#### ***Figure 5: Quantitative measurements of various animal size parameters***
```{r, echo = FALSE, message = FALSE, fig.width = 10, fig.height = 8}
## showing now length, width, volume for sorter acquired data
length <- all %>%
  ggplot(.) +
  aes(x = as.numeric(hour), y = s_length) +
  geom_boxplot(aes(group = hour), outlier.alpha = 0) +
  geom_jitter(size=0.1, width=0.2, alpha=0.2) +
  scale_x_continuous(breaks = seq(0, 70, 5)) +
  theme_cowplot(font_size = 12, rel_small = 10/12) +
  labs(x="Time (h)", y = expression(paste("Median Length (", mu,"m)")))

width <- all %>%
  ggplot(.) +
  aes(x = as.numeric(hour), y = s_width) +
  geom_boxplot(aes(group = hour), outlier.alpha = 0) +
  geom_jitter(size=0.1, width=0.2, alpha=0.2) +
  scale_x_continuous(breaks = seq(0, 70, 5)) +
  theme_cowplot(font_size = 12, rel_small = 10/12) +
  labs(x="Time (h)", y = expression(paste("Median Width (", mu,"m)")))

volume <- all %>%
  ggplot(.) +
  aes(x = as.numeric(hour), y = s_volume) +
  geom_boxplot(aes(group = hour), outlier.alpha = 0) +
  geom_jitter(size=0.1, width=0.2, alpha=0.2) +
  scale_x_continuous(breaks = seq(0, 70, 5)) +
  theme_cowplot(font_size = 12, rel_small = 10/12) +
  labs(x="Time (h)", y=expression(paste("Median Volume (", mu, m^3,")")))

volume2 <- all %>%
  ggplot(.) +
  aes(x = as.numeric(hour), y = s_volume) +
  geom_boxplot(aes(group = hour), outlier.alpha = 0) +
  geom_jitter(size=0.1, width=0.2, alpha=0.2) +
  scale_x_continuous(breaks = seq(0, 70, 5)) +
  theme_cowplot(font_size = 12, rel_small = 10/12) +
  scale_y_log10() +
  labs(x="Time (h)", y=expression(paste("log Median Volume (", mu, m^3,")")))

plot_grid(length, width, volume, volume2, ncol = 2, nrow = 2, align = "hv")

```


### 4. Fluorescence dynamics give clues to feeding behavior
+ Walk through fluorescence data
+ Draw the connection between fluorescence dynamics and feeding behavior of animals during development
  + Discuss how fluorescence can be used to outline larval stages
  + Discuss how changes in fluorescence from sorter data relate to images of wells at those timepoints (appearance of cuticles as identified by students)

#### ***Figure 6:  Red fluorescence for all replicates***
```{r, message = FALSE, echo = FALSE, fig.width = 8, fig.height = 10}

red <- clean_plate %>%
  dplyr::group_by(replicate, timepoint, row, col) %>%
  dplyr::summarize(median.red = median(red), .groups = "drop") %>%
  ggplot(.) +
  aes(x = as.numeric(timepoint), y = median.red) + 
  geom_boxplot(aes(group = timepoint), outlier.alpha = 0) +
  geom_jitter(size=0.2, width=0.2, alpha=0.4) +
  geom_smooth(span = 0.1, se = F, size = 0.5, method = "loess") +
  scale_x_continuous(breaks = seq(0, 70, 5)) +
  theme_cowplot(font_size = 12, rel_small = 10/12) +
  labs(x="Time (h)", y = "Median red fluorescence")

red_tof <- clean_plate %>%
  dplyr::group_by(replicate, timepoint, row, col) %>%
  dplyr::summarize(median.red = median(red/TOF), .groups = "drop") %>%
  ggplot(.) +
  aes(x = as.numeric(timepoint), y = median.red) + 
  geom_boxplot(aes(group = timepoint), outlier.alpha = 0) +
  geom_jitter(size=0.2, width=0.2, alpha=0.4) +
  geom_smooth(span = 0.1, se = F, size = 0.5, method = "loess") +
  scale_x_continuous(breaks = seq(0, 70, 5)) +
  theme_cowplot(font_size = 12, rel_small = 10/12) +
  labs(x="Time (h)", y = "Median red normalized by length")

red_area <- clean_plate %>%
  dplyr::group_by(replicate, timepoint, row, col) %>%
  dplyr::summarize(median.red = median(red/EXT), .groups = "drop") %>%
  ggplot(.) +
  aes(x = as.numeric(timepoint), y = median.red) + 
  geom_boxplot(aes(group = timepoint), outlier.alpha = 0) +
  geom_jitter(size=0.2, width=0.2, alpha=0.4) +
  geom_smooth(span = 0.1, se = F, size = 0.5, method = "loess") +
  scale_x_continuous(breaks = seq(0, 70, 5)) +
  theme_cowplot(font_size = 12, rel_small = 10/12) +
  labs(x="Time (h)", y = "Median red normalized by area")

plot_grid(red, red_tof, red_area, nrow = 3, align = "hv")

```


```{r}
tof <- clean_plate %>%
  dplyr::group_by(replicate, timepoint, row, col) %>%
  dplyr::summarize(median.TOF = median(TOF), .groups = "drop") %>%
  ggplot(.) +
  aes(x = as.numeric(timepoint), y = median.TOF) + 
  geom_boxplot(aes(group = timepoint), outlier.alpha = 0) +
  geom_jitter(size=0.2, width=0.2, alpha=0.4) +
  scale_x_continuous(breaks = seq(0, 70, 5)) +
  theme_cowplot(font_size = 16, rel_small = 12/16) +
  labs(x="Time (h)", y = expression(paste("Median Animal Length (", mu,"m)")))



```






